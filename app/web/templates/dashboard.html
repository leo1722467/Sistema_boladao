{% extends 'base.html' %}
{% block title %}Dashboard - Sistema Boladão{% endblock %}
{% block extra_head %}
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8f9fa; color: #333; line-height: 1.6; }
  .container { padding: 30px; max-width: 1400px; }
  .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 30px; }
  .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 4px solid #3498db; transition: transform 0.3s ease; }
  .stat-card:hover { transform: translateY(-2px); }
  .stat-card.warning { border-left-color: #f39c12; }
  .stat-card.danger { border-left-color: #e74c3c; }
  .stat-card.success { border-left-color: #27ae60; }
  .stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
  .stat-title { font-size: 14px; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
  .stat-icon { width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; }
  .stat-icon.primary { background: linear-gradient(135deg, #3498db, #2980b9); }
  .stat-icon.warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
  .stat-icon.danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
  .stat-icon.success { background: linear-gradient(135deg, #27ae60, #229954); }
  .stat-value { font-size: 32px; font-weight: 700; color: #2c3e50; margin-bottom: 5px; }
  .stat-change { font-size: 12px; color: #666; }
  .stat-change.positive { color: #27ae60; }
  .stat-change.negative { color: #e74c3c; }
  .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
  .action-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-decoration: none; color: inherit; transition: all 0.3s ease; border: 1px solid #e9ecef; }
  .action-card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); text-decoration: none; color: inherit; }
  .action-header { display: flex; align-items: center; margin-bottom: 15px; }
  .action-icon { width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: white; margin-right: 15px; }
  .action-title { font-size: 18px; font-weight: 600; color: #2c3e50; }
  .action-description { color: #666; font-size: 14px; line-height: 1.5; }
  .recent-activity { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); overflow: hidden; }
  .activity-header { padding: 20px 25px; border-bottom: 1px solid #e9ecef; background: #f8f9fa; }
  .activity-header h3 { font-size: 18px; font-weight: 600; color: #2c3e50; }
  .activity-list { max-height: 400px; overflow-y: auto; }
  .activity-item { padding: 15px 25px; border-bottom: 1px solid #f1f3f4; display: flex; align-items: center; }
  .activity-item:last-child { border-bottom: none; }
  .activity-icon { width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; color: white; margin-right: 15px; flex-shrink: 0; }
  .activity-content { flex: 1; }
  .activity-text { font-size: 14px; color: #2c3e50; margin-bottom: 3px; }
  .activity-time { font-size: 12px; color: #666; }
  @media (max-width: 768px) { .dashboard-grid { grid-template-columns: 1fr; } .quick-actions { grid-template-columns: 1fr; } .container { padding: 20px; } }
  .btn { display: inline-flex; align-items: center; padding: 10px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; text-decoration: none; cursor: pointer; transition: all 0.3s ease; }
  .btn-primary { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
  .btn-primary:hover { background: linear-gradient(135deg, #2980b9, #21618c); transform: translateY(-1px); }
  .btn i { margin-right: 8px; }
</style>
{% endblock %}
{% block content %}
  <div class="dashboard-grid">
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-title">Chamados Abertos</div>
        <div class="stat-icon primary"><i class="fas fa-ticket-alt"></i></div>
      </div>
      <div class="stat-value" id="openTickets">--</div>
      <div class="stat-change"><i class="fas fa-arrow-up"></i><span class="positive">+12% esta semana</span></div>
    </div>
    <div class="stat-card warning">
      <div class="stat-header">
        <div class="stat-title">SLA em Risco</div>
        <div class="stat-icon warning"><i class="fas fa-exclamation-triangle"></i></div>
      </div>
      <div class="stat-value" id="slaRisk">--</div>
      <div class="stat-change"><i class="fas fa-arrow-down"></i><span class="negative">-5% hoje</span></div>
    </div>
    <div class="stat-card success">
      <div class="stat-header">
        <div class="stat-title">Ordens Concluídas</div>
        <div class="stat-icon success"><i class="fas fa-check-circle"></i></div>
      </div>
      <div class="stat-value" id="completedOrders">--</div>
      <div class="stat-change"><i class="fas fa-arrow-up"></i><span class="positive">+8% esta semana</span></div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-title">Ativos Ativos</div>
        <div class="stat-icon primary"><i class="fas fa-desktop"></i></div>
      </div>
      <div class="stat-value" id="activeAssets">--</div>
      <div class="stat-change"><i class="fas fa-arrow-up"></i><span class="positive">+3% este mês</span></div>
    </div>
  </div>
  <div class="quick-actions">
    <a href="/admin/flow-engine" class="action-card">
      <div class="action-header"><div class="action-icon primary"><i class="fas fa-cogs"></i></div><div class="action-title">Flow Engine</div></div>
      <div class="action-description">Configure fluxos passo a passo personalizados para qualquer modelo. Selecione campos, defina ordem e crie interfaces dinâmicas.</div>
    </a>
    <a href="/admin/chamado/create-flow" class="action-card">
      <div class="action-header"><div class="action-icon warning"><i class="fas fa-gamepad"></i></div><div class="action-title">Criar Chamado</div></div>
      <div class="action-description">Interface passo a passo para criação de novos chamados. Experiência gamificada e intuitiva para registro de solicitações.</div>
    </a>
    <a href="/web/tables" class="action-card">
      <div class="action-header"><div class="action-icon success"><i class="fas fa-table"></i></div><div class="action-title">Gerenciar Tabelas</div></div>
      <div class="action-description">Acesso rápido a todas as tabelas do sistema organizadas por categoria. Visualize, crie e edite registros de forma intuitiva.</div>
    </a>
    <a href="/web/tables" class="action-card">
      <div class="action-header"><div class="action-icon danger"><i class="fas fa-user-shield"></i></div><div class="action-title">Painel Administrativo</div></div>
      <div class="action-description">Interface administrativa completa para gerenciamento avançado de dados. Acesso direto às funcionalidades de CRUD.</div>
    </a>
  </div>
  <div class="recent-activity">
    <div class="activity-header"><h3>Atividade Recente</h3></div>
    <div class="activity-list">
      <div class="activity-item"><div class="activity-icon primary"><i class="fas fa-ticket-alt"></i></div><div class="activity-content"><div class="activity-text">Novo chamado #1234 criado</div><div class="activity-time">há 5 minutos</div></div></div>
      <div class="activity-item"><div class="activity-icon success"><i class="fas fa-check"></i></div><div class="activity-content"><div class="activity-text">Ordem de serviço #OS-456 concluída</div><div class="activity-time">há 15 minutos</div></div></div>
      <div class="activity-item"><div class="activity-icon warning"><i class="fas fa-exclamation"></i></div><div class="activity-content"><div class="activity-text">SLA do chamado #1230 em risco</div><div class="activity-time">há 30 minutos</div></div></div>
    </div>
  </div>
{% endblock %}
{% block scripts %}
<script>
  async function loadDashboardData() {
    try {
      const tokenCookie = document.cookie.split('; ').find(row => row.startsWith('access_token='));
      const token = tokenCookie ? tokenCookie.split('=')[1] : null;
      const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
      const ticketResponse = await fetch('/api/helpdesk/analytics', { credentials: 'include', headers });
      if (ticketResponse.ok) {
        const ticketData = await ticketResponse.json();
        document.getElementById('openTickets').textContent = ticketData.total_tickets || 0;
        document.getElementById('slaRisk').textContent = ticketData.sla_breaches || 0;
      }
      const soResponse = await fetch('/api/helpdesk/service-orders/analytics', { credentials: 'include', headers });
      if (soResponse.ok) {
        const soData = await soResponse.json();
        document.getElementById('completedOrders').textContent = soData.total_service_orders || 0;
      }
      const assetResponse = await fetch('/api/helpdesk/assets?limit=1', { credentials: 'include', headers });
      if (assetResponse.ok) {
        const assetData = await assetResponse.json();
        document.getElementById('activeAssets').textContent = assetData.total || 0;
      }
    } catch (error) {
      console.error('Error loading dashboard data:', error);
    }
  }
  document.addEventListener('DOMContentLoaded', loadDashboardData);
  setInterval(loadDashboardData, 5 * 60 * 1000);
</script>
{% endblock %}
